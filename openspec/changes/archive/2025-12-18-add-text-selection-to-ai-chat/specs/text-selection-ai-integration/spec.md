# Text Selection to AI Chat Integration Specification

## MODIFIED Requirements

### Requirement: AI 對話界面
系統 SHALL 提供一個對話界面，允許用戶與 AI 進行文字對話，並接收 AI 的回應。**此外，系統 SHALL 支援通過拖曳或右鍵選單將選取的文字內容添加到對話中。**

#### Scenario: 拖曳文字到對話框
- **WHEN** 用戶在頁面上選取文字
- **AND** 拖曳選取的文字到 AI 對話框區域
- **THEN** 系統顯示拖曳接收的視覺反饋（如高亮邊框）
- **AND** 當用戶釋放滑鼠時，選取的文字自動填充到輸入框
- **AND** 對話框自動獲得焦點，游標定位在輸入框

#### Scenario: 拖曳文字到懸浮按鈕
- **WHEN** 用戶在頁面上選取文字
- **AND** 拖曳選取的文字到 AI 懸浮按鈕
- **THEN** 懸浮按鈕顯示拖曳接收的視覺反饋（如高亮或圖標變化）
- **AND** 當用戶釋放滑鼠時，系統自動打開對話框
- **AND** 選取的文字自動填充到輸入框
- **AND** 對話框自動獲得焦點

#### Scenario: 右鍵選單發送文字
- **WHEN** 用戶在頁面上選取文字
- **AND** 在選取區域上點擊右鍵
- **THEN** 系統顯示自定義右鍵選單
- **AND** 選單包含「發送到 AI 助手」選項
- **AND** 當用戶點擊該選項時，系統打開對話框（如未打開）
- **AND** 選取的文字自動填充到輸入框

#### Scenario: 拖曳視覺反饋
- **WHEN** 用戶拖曳選取的文字
- **THEN** 系統在可接收拖曳的區域（懸浮按鈕、對話框）顯示視覺提示
- **AND** 視覺提示包括高亮邊框、圖標變化或背景色變化
- **AND** 當拖曳離開接收區域時，視覺提示消失

#### Scenario: 文字選取檢測
- **WHEN** 用戶在頁面上選取文字
- **THEN** 系統檢測到文字選取事件
- **AND** 系統獲取選取的文字內容
- **AND** 系統準備好接收拖曳或右鍵選單操作

#### Scenario: 自動填充輸入框
- **WHEN** 用戶通過拖曳或右鍵選單添加選取文字
- **THEN** 系統將選取的文字填充到對話輸入框
- **AND** 如果輸入框已有內容，選取文字追加到現有內容後（或替換，根據設定）
- **AND** 游標定位在輸入框末尾
- **AND** 用戶可以編輯填充的文字

#### Scenario: 空選取處理
- **WHEN** 用戶嘗試拖曳或右鍵選單，但沒有選取文字
- **THEN** 系統不執行任何操作
- **AND** 不顯示錯誤訊息（靜默失敗）

#### Scenario: 長文字處理
- **WHEN** 用戶選取的文字很長（超過一定長度）
- **THEN** 系統仍然填充完整文字到輸入框
- **AND** 輸入框自動調整高度以容納內容
- **AND** 系統可以添加提示訊息（可選）

## ADDED Requirements

### Requirement: 拖曳功能支援
系統 SHALL 支援將選取的文字拖曳到 AI 助手相關區域，並自動填充到對話輸入框。

#### Scenario: 拖曳數據格式
- **WHEN** 用戶拖曳選取的文字
- **THEN** 系統使用 HTML5 Drag and Drop API
- **AND** 拖曳數據包含文字內容和來源資訊
- **AND** 數據格式為標準的 `text/plain` 或自定義格式

#### Scenario: 拖曳接收區域
- **WHEN** 用戶拖曳文字到可接收區域
- **THEN** 系統阻止默認拖曳行為
- **AND** 系統允許放置操作
- **AND** 系統顯示視覺反饋

#### Scenario: 拖曳放置處理
- **WHEN** 用戶在接收區域釋放拖曳的文字
- **THEN** 系統獲取拖曳的文字內容
- **AND** 系統驗證文字內容不為空
- **AND** 系統執行填充操作

### Requirement: 右鍵選單功能
系統 SHALL 在用戶選取文字時提供右鍵選單，允許快速將選取內容發送到 AI 助手。

#### Scenario: 右鍵選單顯示
- **WHEN** 用戶在選取的文字上點擊右鍵
- **THEN** 系統檢測到右鍵事件
- **AND** 系統檢查是否有選取文字
- **AND** 如果有選取文字，系統顯示自定義右鍵選單
- **AND** 選單包含「發送到 AI 助手」選項

#### Scenario: 右鍵選單樣式
- **WHEN** 自定義右鍵選單顯示
- **THEN** 選單使用 Ant Design Menu 組件樣式
- **AND** 選單位置在滑鼠點擊位置附近
- **AND** 選單不遮擋選取的文字
- **AND** 選單具有適當的 z-index

#### Scenario: 右鍵選單操作
- **WHEN** 用戶點擊「發送到 AI 助手」選項
- **THEN** 系統獲取選取的文字內容
- **AND** 系統關閉右鍵選單
- **AND** 系統執行發送操作（打開對話框並填充文字）

#### Scenario: 右鍵選單關閉
- **WHEN** 用戶點擊選單外部區域
- **OR** 用戶點擊選單中的選項
- **OR** 用戶按下 ESC 鍵
- **THEN** 系統關閉右鍵選單

### Requirement: 文字選取工具
系統 SHALL 提供工具函數來檢測和獲取頁面上選取的文字內容。

#### Scenario: 獲取選取文字
- **WHEN** 系統需要獲取當前選取的文字
- **THEN** 系統使用 `window.getSelection()` API
- **AND** 系統獲取選取範圍的文字內容
- **AND** 系統去除首尾空白字符
- **AND** 系統返回清理後的文字內容

#### Scenario: 檢測文字選取
- **WHEN** 系統需要檢測是否有文字選取
- **THEN** 系統檢查 `window.getSelection()` 是否為空
- **AND** 系統檢查選取範圍是否有效
- **AND** 系統返回布林值表示是否有選取

#### Scenario: 清除文字選取
- **WHEN** 系統完成文字處理操作
- **THEN** 系統可以選擇清除當前選取（可選）
- **AND** 清除操作不影響已填充的文字內容

