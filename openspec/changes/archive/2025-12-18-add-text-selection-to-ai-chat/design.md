# Design: 文字選取到 AI 聊天室功能

## Context

用戶在瀏覽醫療報告、檢查結果等內容時，經常需要將特定文字段落發送到 AI 助手進行分析。目前需要手動複製貼上，流程不夠順暢。

## Goals / Non-Goals

### Goals
- 支援拖曳選取文字到 AI 懸浮按鈕或對話框
- 支援右鍵選單快速發送選取文字
- 自動填充選取內容到對話輸入框
- 提供清晰的視覺反饋
- 保持與現有 AI 助手功能的無縫整合

### Non-Goals
- 不實作圖片拖曳（僅文字）
- 不實作跨頁面拖曳（僅當前頁面）
- 不實作複雜的文字格式化（保持純文字）
- 不實作選取歷史記錄

## Decisions

### Decision: 使用 HTML5 Drag and Drop API
**理由**: 
- 原生瀏覽器 API，無需額外依賴
- 廣泛支援，相容性好
- 與現有 Ant Design 組件相容

**替代方案考慮**:
- 第三方拖曳庫（如 react-dnd）：增加依賴，不符合「簡單優先」原則
- 自定義拖曳實作：需要處理更多邊緣情況

### Decision: 使用自定義右鍵選單而非瀏覽器原生
**理由**: 
- 可以完全控制選單樣式和行為
- 與 Ant Design 設計語言一致
- 可以添加更多自定義選項

**實作方式**:
- 監聽 `contextmenu` 事件
- 檢查是否有選取文字
- 顯示自定義選單（使用 Ant Design Dropdown 或 Menu）

### Decision: 拖曳到懸浮按鈕時自動打開對話框
**理由**: 
- 提供即時反饋
- 減少用戶操作步驟
- 符合用戶預期

**替代方案考慮**:
- 僅填充到輸入框，不自動打開：需要額外點擊，體驗較差

### Decision: 選取文字自動填充到輸入框而非直接發送
**理由**: 
- 給用戶編輯機會
- 可以添加額外說明
- 更符合對話式互動

**替代方案考慮**:
- 直接發送：可能導致誤操作，用戶無法修改

## Risks / Trade-offs

### Risk: 拖曳可能與頁面其他拖曳功能衝突
**緩解措施**: 
- 僅在選取文字時啟用拖曳
- 檢查拖曳數據類型，避免衝突
- 使用特定數據格式標識

### Risk: 右鍵選單可能與瀏覽器原生選單衝突
**緩解措施**: 
- 僅在有文字選取時顯示自定義選單
- 阻止事件冒泡
- 提供清晰的視覺區分

### Risk: 跨瀏覽器相容性問題
**緩解措施**: 
- 使用標準 API
- 添加瀏覽器檢測和降級方案
- 充分測試主流瀏覽器

### Trade-off: 拖曳 vs 右鍵選單
**選擇**: 同時提供兩種方式
**理由**: 
- 不同用戶習慣不同
- 拖曳適合快速操作
- 右鍵選單適合精確控制

## Migration Plan

### Phase 1: MVP（最小可行產品）
1. 基本拖曳功能（拖曳到對話框）
2. 基本右鍵選單（發送到 AI）
3. 自動填充到輸入框

### Phase 2: 增強功能
1. 拖曳到懸浮按鈕
2. 視覺反饋優化
3. 來源標記

### Phase 3: 進階功能（可選）
1. 選取歷史記錄
2. 批量選取發送
3. 格式化文字支援

## Open Questions

1. **拖曳目標**: 是否同時支援拖曳到懸浮按鈕和對話框？
   - 建議：都支援，懸浮按鈕自動打開對話框

2. **文字長度限制**: 是否需要限制選取文字的長度？
   - 建議：不限制，但可以添加提示

3. **格式化**: 是否需要保留文字格式（粗體、斜體等）？
   - 建議：MVP 階段僅支援純文字，後續可擴充

4. **多選**: 是否支援多個選取區域？
   - 建議：MVP 階段僅支援單一選取，後續可擴充

